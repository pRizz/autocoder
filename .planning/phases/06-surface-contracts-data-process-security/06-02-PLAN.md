---
phase: 06-surface-contracts-data-process-security
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/specs/surfaces/PROCESS-LIFECYCLE-MATRIX.md
  - .planning/specs/surfaces/PROCESS-LIFECYCLE-CONTRACTS.md
autonomous: true
requirements: ["SURF-04"]
user_setup: []
must_haves:
  truths:
    - "Process/session contracts capture start/stop/retry/lock/cleanup semantics across agent, scheduler, devserver, terminal, and chat-session lifecycle components."
    - "Lifecycle contracts define observable state transitions and crash/recovery behavior required for reproducible orchestration."
  artifacts:
    - ".planning/specs/surfaces/PROCESS-LIFECYCLE-MATRIX.md"
    - ".planning/specs/surfaces/PROCESS-LIFECYCLE-CONTRACTS.md"
  key_links:
    - "PROCESS-LIFECYCLE-CONTRACTS.md references PROCESS-LIFECYCLE-MATRIX.md as canonical 12-unit lifecycle completeness source."
---

<objective>
Document the complete orchestration/process/session lifecycle surface as authoritative contracts.

Purpose: Satisfy SURF-04 by specifying lifecycle states, transitions, lock/recovery semantics, and cleanup behavior.
Output: Process lifecycle matrix plus detailed lifecycle contract specification.
</objective>

<execution_context>
@/Users/peterryszkiewicz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/peterryszkiewicz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/specs/INVENTORY.md
@.planning/specs/contracts/BACKEND-RUNTIME-MATRIX.md
@server/routers/agent.py
@server/routers/schedules.py
@server/routers/terminal.py
@server/services/process_manager.py
@server/services/scheduler_service.py
@server/services/dev_server_manager.py
@server/services/terminal_manager.py
@server/services/assistant_chat_session.py
@server/services/spec_chat_session.py
@server/services/expand_chat_session.py
@server/utils/process_utils.py
@server/main.py
@.planning/phases/06-surface-contracts-data-process-security/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build canonical process/session lifecycle matrix</name>
  <files>.planning/specs/surfaces/PROCESS-LIFECYCLE-MATRIX.md</files>
  <action>Create a matrix with exactly 12 lifecycle contract units (`P01`..`P12`) covering: agent lifecycle states/transitions, lock-file behavior, graceful pause drain semantics, scheduler start/stop windows and midnight crossing, crash retry/backoff, manual override behavior, devserver lifecycle and URL detection, terminal PTY/session lifecycle, chat-session client lifecycle, and process-tree termination semantics. Include columns for unit id, component, source `ART-####`, state model, transition triggers, and failure/cleanup guarantees.</action>
  <verify>test -f .planning/specs/surfaces/PROCESS-LIFECYCLE-MATRIX.md && test "$(rg -n '^\\| P[0-9]{2} \\|' .planning/specs/surfaces/PROCESS-LIFECYCLE-MATRIX.md | wc -l | tr -d ' ')" = "12"</verify>
  <done>Process matrix exists with deterministic 12-unit lifecycle inventory and artifact linkage.</done>
</task>

<task type="auto">
  <name>Task 2: Author orchestration and lifecycle contracts</name>
  <files>.planning/specs/surfaces/PROCESS-LIFECYCLE-CONTRACTS.md</files>
  <action>Author lifecycle contracts for agent (`start/stop/pause/resume/graceful_pause/graceful_resume/healthcheck`), scheduler (UTC cron jobs, active-window checks, overrides, crash retry), devserver lifecycle (command start/stop/health and lock handling), terminal lifecycle (session create/start/write/resize/stop/cleanup), and chat session lifecycle (init/query/close/cleanup). Document lock behavior, race/edge handling, and deterministic cleanup semantics.</action>
  <verify>rg -n "status|stopped|running|paused|crashed|graceful|lock|cleanup|retry|override|UTC|midnight|kill_process_tree|terminal|chat session|Acceptance Checks" .planning/specs/surfaces/PROCESS-LIFECYCLE-CONTRACTS.md</verify>
  <done>Lifecycle contract doc captures start/stop/retry/lock/cleanup semantics across orchestration components.</done>
</task>

<task type="auto">
  <name>Task 3: Add SURF-04 acceptance checks with lifecycle parity gates</name>
  <files>.planning/specs/surfaces/PROCESS-LIFECYCLE-CONTRACTS.md</files>
  <action>Add `Acceptance Checks` with explicit pass/fail criteria proving matrix-to-contract parity (`12/12`), state-transition coverage, and crash/recovery/cleanup behavior coverage.</action>
  <verify>rg -n "Acceptance Checks|SURF-04|12/12|state transition|crash|retry|cleanup|pass/fail" .planning/specs/surfaces/PROCESS-LIFECYCLE-CONTRACTS.md</verify>
  <done>Process contracts include executable acceptance checks aligned to SURF-04.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] test -f .planning/specs/surfaces/PROCESS-LIFECYCLE-MATRIX.md
- [ ] test -f .planning/specs/surfaces/PROCESS-LIFECYCLE-CONTRACTS.md
- [ ] test "$(rg -n '^\\| P[0-9]{2} \\|' .planning/specs/surfaces/PROCESS-LIFECYCLE-MATRIX.md | wc -l | tr -d ' ')" = "12"
- [ ] rg -n "SURF-04|Acceptance Checks|12/12|graceful|retry|lock|cleanup" .planning/specs/surfaces/PROCESS-LIFECYCLE-CONTRACTS.md
- [ ] git diff --name-only | rg -v '^\.planning/' returns no output
</verification>

<success_criteria>

- All tasks completed
- Process/session contracts capture full orchestration lifecycle semantics
- Acceptance checks objectively prove SURF-04 lifecycle coverage
- No source implementation files modified

</success_criteria>

<output>
After completion, create `.planning/phases/06-surface-contracts-data-process-security/06-02-SUMMARY.md`
</output>
