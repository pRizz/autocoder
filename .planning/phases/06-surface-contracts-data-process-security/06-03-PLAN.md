---
phase: 06-surface-contracts-data-process-security
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/specs/surfaces/SECURITY-POLICY-MATRIX.md
  - .planning/specs/surfaces/SECURITY-POLICY-CONTRACTS.md
autonomous: true
requirements: ["SURF-05"]
user_setup: []
must_haves:
  truths:
    - "Security contracts capture command/path constraints, trust boundaries, and safe defaults across backend policy enforcement points."
    - "Security contract corpus links policy behavior to concrete validators and test evidence for regression-proof regeneration."
  artifacts:
    - ".planning/specs/surfaces/SECURITY-POLICY-MATRIX.md"
    - ".planning/specs/surfaces/SECURITY-POLICY-CONTRACTS.md"
  key_links:
    - "SECURITY-POLICY-CONTRACTS.md references SECURITY-POLICY-MATRIX.md as canonical 15-unit policy completeness source."
---

<objective>
Document the complete security/policy surface as authoritative contracts.

Purpose: Satisfy SURF-05 by specifying command/path constraints, trust boundaries, and policy-safe runtime defaults.
Output: Security policy matrix plus detailed security contract specification.
</objective>

<execution_context>
@/Users/peterryszkiewicz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/peterryszkiewicz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/specs/INVENTORY.md
@.planning/specs/contracts/BACKEND-RUNTIME-MATRIX.md
@security.py
@auth.py
@rate_limit_utils.py
@server/utils/validation.py
@server/main.py
@server/routers/devserver.py
@server/routers/filesystem.py
@server/services/dev_server_manager.py
@test_devserver_security.py
@test_rate_limit_utils.py
@test_security.py
@test_security_integration.py
@.planning/phases/06-surface-contracts-data-process-security/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build canonical security/policy matrix</name>
  <files>.planning/specs/surfaces/SECURITY-POLICY-MATRIX.md</files>
  <action>Create a matrix with exactly 15 policy contract units (`S01`..`S15`) covering: command extraction/segmentation, allowlist-blocklist hierarchy, command-specific validators (`pkill`, `chmod`, `init.sh`, `playwright-cli`), org/project config precedence, devserver strict command policy + metacharacter rejection, filesystem blocked-path/UNC policy, project-name validation policy, localhost trust boundary middleware/CORS behavior, auth-error detection contracts, rate-limit detection/backoff contracts, and security test evidence anchors. Include columns for unit id, policy concern, enforcement artifact `ART-####`, default behavior, escalation/block behavior, and test evidence.</action>
  <verify>test -f .planning/specs/surfaces/SECURITY-POLICY-MATRIX.md && test "$(rg -n '^\\| S[0-9]{2} \\|' .planning/specs/surfaces/SECURITY-POLICY-MATRIX.md | wc -l | tr -d ' ')" = "15"</verify>
  <done>Security matrix exists with deterministic 15-unit policy inventory and enforcement/test linkage.</done>
</task>

<task type="auto">
  <name>Task 2: Author security and trust-boundary contracts</name>
  <files>.planning/specs/surfaces/SECURITY-POLICY-CONTRACTS.md</files>
  <action>Author detailed policy contracts for command safety (`ALLOWED_COMMANDS`, `BLOCKED_COMMANDS`, `DANGEROUS_COMMANDS`, hierarchy resolution), devserver command structure validation, filesystem path restrictions (`SENSITIVE_DIRECTORIES`, platform blocked roots, UNC blocking), project-name validation, localhost-only policy (when remote mode is disabled), auth-error detection/messaging, and rate-limit parsing/backoff semantics. Include explicit trust boundaries, safe defaults, and failure behavior.</action>
  <verify>rg -n "ALLOWED_COMMANDS|BLOCKED_COMMANDS|DANGEROUS_COMMANDS|pkill|chmod|playwright-cli|validate_custom_command_strict|SENSITIVE_DIRECTORIES|UNC|localhost|ALLOW_REMOTE|auth|rate limit|backoff|Acceptance Checks" .planning/specs/surfaces/SECURITY-POLICY-CONTRACTS.md</verify>
  <done>Security contract doc defines policy constraints and trust boundaries with enforceable semantics.</done>
</task>

<task type="auto">
  <name>Task 3: Add SURF-05 acceptance checks with policy/test parity gates</name>
  <files>.planning/specs/surfaces/SECURITY-POLICY-CONTRACTS.md</files>
  <action>Add `Acceptance Checks` with pass/fail criteria proving matrix-to-contract parity (`15/15`), command/path/trust-boundary coverage, and linkage to security test artifacts (`ART-0141`, `ART-0142`, `ART-0143`, `ART-0144`).</action>
  <verify>rg -n "Acceptance Checks|SURF-05|15/15|command|path|trust boundary|ART-0141|ART-0142|ART-0143|ART-0144|pass/fail" .planning/specs/surfaces/SECURITY-POLICY-CONTRACTS.md</verify>
  <done>Security contracts include executable acceptance checks aligned to SURF-05.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] test -f .planning/specs/surfaces/SECURITY-POLICY-MATRIX.md
- [ ] test -f .planning/specs/surfaces/SECURITY-POLICY-CONTRACTS.md
- [ ] test "$(rg -n '^\\| S[0-9]{2} \\|' .planning/specs/surfaces/SECURITY-POLICY-MATRIX.md | wc -l | tr -d ' ')" = "15"
- [ ] rg -n "SURF-05|Acceptance Checks|15/15|SENSITIVE_DIRECTORIES|ALLOW_REMOTE|ART-0144" .planning/specs/surfaces/SECURITY-POLICY-CONTRACTS.md
- [ ] git diff --name-only | rg -v '^\.planning/' returns no output
</verification>

<success_criteria>

- All tasks completed
- Security/policy contracts capture command/path constraints and trust boundaries
- Acceptance checks objectively prove SURF-05 policy coverage
- No source implementation files modified

</success_criteria>

<output>
After completion, create `.planning/phases/06-surface-contracts-data-process-security/06-03-SUMMARY.md`
</output>
