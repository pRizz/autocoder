---
phase: 05-surface-contracts-api-and-websocket
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/specs/surfaces/WEBSOCKET-ENDPOINT-MATRIX.md
  - .planning/specs/surfaces/WEBSOCKET-CONTRACTS.md
autonomous: true
requirements: ["SURF-02"]
user_setup: []
must_haves:
  truths:
    - "WebSocket contract corpus includes every mounted WebSocket endpoint and its bidirectional message protocol."
    - "WebSocket contracts capture event schema, ordering/lifecycle assumptions, and failure/close behavior."
  artifacts:
    - ".planning/specs/surfaces/WEBSOCKET-ENDPOINT-MATRIX.md"
    - ".planning/specs/surfaces/WEBSOCKET-CONTRACTS.md"
  key_links:
    - "WEBSOCKET-CONTRACTS.md references WEBSOCKET-ENDPOINT-MATRIX.md as canonical endpoint/message completeness source."
---

<objective>
Document the complete WebSocket/realtime surface as authoritative message contracts.

Purpose: Satisfy SURF-02 by capturing endpoint protocols, event payloads, ordering assumptions, and failure modes.
Output: WebSocket endpoint/message matrix plus detailed protocol contract specification.
</objective>

<execution_context>
@/Users/peterryszkiewicz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/peterryszkiewicz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/specs/INVENTORY.md
@.planning/specs/contracts/FILE-CONTRACT-COVERAGE.md
@server/main.py
@server/websocket.py
@server/routers/assistant_chat.py
@server/routers/spec_creation.py
@server/routers/expand_project.py
@server/routers/terminal.py
@ui/src/hooks/useWebSocket.ts
@ui/src/lib/types.ts
@.planning/phases/05-surface-contracts-api-and-websocket/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build canonical WebSocket endpoint/message matrix</name>
  <files>.planning/specs/surfaces/WEBSOCKET-ENDPOINT-MATRIX.md</files>
  <action>Create matrix for all mounted WebSocket endpoints (expected total: 5). For each endpoint include path, implementing artifact ART ID, client->server message types, server->client message types, heartbeat behavior, and close/error semantics.</action>
  <verify>test -f .planning/specs/surfaces/WEBSOCKET-ENDPOINT-MATRIX.md && test "$(rg -n '^\\| /' .planning/specs/surfaces/WEBSOCKET-ENDPOINT-MATRIX.md | wc -l | tr -d ' ')" = "5"</verify>
  <done>WebSocket matrix exists with complete endpoint and message-type inventory for all realtime channels.</done>
</task>

<task type="auto">
  <name>Task 2: Author websocket protocol contract specification</name>
  <files>.planning/specs/surfaces/WEBSOCKET-CONTRACTS.md</files>
  <action>Author detailed protocol contracts for project updates, assistant chat, spec chat, expand chat, and terminal I/O sockets. Include message schemas, required fields, ordering/response expectations, keepalive handling, and recoverable vs terminal failure behaviors.</action>
  <verify>rg -n \"Project Updates|Assistant Chat|Spec Chat|Expand Chat|Terminal|Client -> Server|Server -> Client|Ordering|Failure Modes|Close Codes\" .planning/specs/surfaces/WEBSOCKET-CONTRACTS.md</verify>
  <done>WebSocket contract doc fully defines message-level protocol behavior for all endpoint channels.</done>
</task>

<task type="auto">
  <name>Task 3: Validate websocket acceptance checks and parity hooks</name>
  <files>.planning/specs/surfaces/WEBSOCKET-CONTRACTS.md</files>
  <action>Add acceptance checks proving endpoint/message completeness (5/5), frontend consumer parity (`ui/src/hooks/useWebSocket.ts`, `ui/src/lib/types.ts`), and explicit ordering/failure semantics for each socket contract.</action>
  <verify>rg -n \"Acceptance Checks|5/5|frontend consumer parity|ordering|failure|pass/fail\" .planning/specs/surfaces/WEBSOCKET-CONTRACTS.md</verify>
  <done>WebSocket contract doc includes executable acceptance checks for SURF-02 verification.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] test -f .planning/specs/surfaces/WEBSOCKET-ENDPOINT-MATRIX.md
- [ ] test -f .planning/specs/surfaces/WEBSOCKET-CONTRACTS.md
- [ ] test "$(rg -n '^\\| /' .planning/specs/surfaces/WEBSOCKET-ENDPOINT-MATRIX.md | wc -l | tr -d ' ')" = "5"
- [ ] rg -n "Acceptance Checks|5/5|Ordering|Failure Modes" .planning/specs/surfaces/WEBSOCKET-CONTRACTS.md
- [ ] git diff --name-only | rg -v '^\.planning/' returns no output
</verification>

<success_criteria>

- All tasks completed
- WebSocket endpoint inventory is complete and canonical
- Contracts capture event schemas, ordering assumptions, and failure behavior for all channels
- No source implementation files modified

</success_criteria>

<output>
After completion, create `.planning/phases/05-surface-contracts-api-and-websocket/05-02-SUMMARY.md`
</output>
